<?xml version='1.0' ?>
<launch>

  <!-- ==================== 기본 인자 설정 ==================== -->
  <arg name="robot_name_1" default="pinky_31"/>
  <arg name="robot_name_2" default="pinky_32"/>
  <arg name="world_name" default="pinky_SOLO.world"/>
  <arg name="world" default="$(find-pkg-share pinky_gazebo)/worlds/$(var world_name)"/>
  <arg name="bridge_params" default="$(find-pkg-share pinky_gazebo)/params/pinky_bridge.yaml"/>

  <!-- 리소스 경로 설정 -->
  <set_env name="GZ_SIM_RESOURCE_PATH"
           value="$(find-pkg-share pinky_description)/../:/$(find-pkg-share pinky_gazebo)/models"/>

  <!-- ==================== 시뮬레이터 실행 ==================== -->
  <include file="$(find-pkg-share ros_gz_sim)/launch/gz_sim.launch.py">
    <arg name='gz_args' value='-r -s -v4 $(var world)'/>
    <arg name='on_exit_shutdown' value='true'/>
  </include>

  <include file="$(find-pkg-share ros_gz_sim)/launch/gz_sim.launch.py">
    <arg name='gz_args' value='-g -v4 '/>
  </include>

  <!-- 위치 인자 -->
  <arg name="x31" default="0.0"/>
  <arg name="y31" default="0.0"/>
  <arg name="Y31" default="0.0"/>
  <arg name="x32" default="0.0"/>
  <arg name="y32" default="0.0"/>
  <arg name="Y32" default="0.0"/>

  <!-- ==================== 첫 번째 로봇 ==================== -->
    <group>
        <push-ros-namespace namespace="$(var robot_name_1)"/>

        <include file="$(find-pkg-share pinky_description)/launch/upload_pinky31.launch.xml">
            <arg name="use_sim_time" value="True"/>
        </include>

        <node pkg="ros_gz_sim" exec="create" name="create_pinky_31" output="screen"
                args="-name $(var robot_name_1) -topic robot_description -x $(var x31) -y $(var y31) -Y $(var Y31)">
            <param name="use_sim_time" value="True"/>
        </node>

        <node pkg="ros_gz_bridge" exec="parameter_bridge" name="bridge_pinky_31" output="screen"
                args="/pinky_31/cmd_vel@geometry_msgs/msg/Twist@gz.msgs.Twist 
                    /pinky_31/odometry@nav_msgs/msg/Odometry@gz.msgs.Odometry"/>

        <node pkg="ros_gz_image" exec="image_bridge" name="image_bridge_pinky_31" output="screen"
                args="/pinky_31/camera/image_raw">
            <remap from="/pinky_31/camera/image" to="/pinky_31/camera/image_raw"/>
        </node>
    </group>

    <!-- ==================== 두 번째 로봇 ==================== -->
    <group>
        <push-ros-namespace namespace="$(var robot_name_2)"/>

        <include file="$(find-pkg-share pinky_description)/launch/upload_pinky32.launch.xml">
            <arg name="use_sim_time" value="True"/>
        </include>

        <node pkg="ros_gz_sim" exec="create" name="create_pinky_32" output="screen"
                args="-name $(var robot_name_2) -topic robot_description -x $(var x32) -y $(var y32) -Y $(var Y32)">
            <param name="use_sim_time" value="True"/>
        </node>

        <node pkg="ros_gz_bridge" exec="parameter_bridge" name="bridge_pinky_32" output="screen"
                args="/pinky_32/cmd_vel@geometry_msgs/msg/Twist@gz.msgs.Twist 
                    /pinky_32/odometry@nav_msgs/msg/Odometry@gz.msgs.Odometry"/>

        <node pkg="ros_gz_image" exec="image_bridge" name="image_bridge_pinky_32" output="screen"
                args="/pinky_32/camera/image_raw">
            <remap from="/pinky_32/camera/image" to="/pinky_32/camera/image_raw"/>
        </node>
    </group>

  <!-- ==================== 전역 브릿지 ==================== -->
  <node pkg="ros_gz_bridge" exec="parameter_bridge" name="parameter_bridge" output="screen"
        args="--ros-args -p config_file:=$(var bridge_params)"/>

</launch>
